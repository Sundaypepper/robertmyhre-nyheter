<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Robert Myhre | Artikkel</title>
  <meta name="description" content="Innsikt og analyser innen offentlige anskaffelser av Robert Myhre.">
  <meta property="og:title" content="Robert Myhre | Artikkel">
  <meta property="og:description" content="Innsikt og analyser innen offentlige anskaffelser av Robert Myhre.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://robertmyhre.no/artikkel.html">
  <meta property="og:image" content="https://robertmyhre.no/bilder/IMG_7162_4.jpg">
  <meta property="og:locale" content="nb_NO">
  <meta property="og:site_name" content="Robert Myhre">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Robert Myhre | Artikkel">
  <meta name="twitter:description" content="Innsikt og analyser innen offentlige anskaffelser.">
  <meta name="twitter:image" content="https://robertmyhre.no/bilder/IMG_7162_4.jpg">
  <link rel="canonical" href="https://robertmyhre.no/artikkel.html">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Robert Myhre">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;0,8..60,700;1,8..60,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#2c2825;--paper:#faf8f5;--warm-bg:#f0ece5;--accent:#9e4a32;--accent-hover:#b85a3f;--muted:#7a7269;--light-muted:#a39e96;--card:#fff;--border:#e2ddd5;--shadow-sm:0 1px 3px rgba(44,40,37,.06);--shadow-md:0 4px 16px rgba(44,40,37,.08);--shadow-lg:0 8px 32px rgba(44,40,37,.1);--serif:'Source Serif 4',Georgia,serif;--sans:'Outfit',system-ui,sans-serif;--max-w:760px}
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:var(--sans);color:var(--ink);background:var(--paper);font-size:16px;line-height:1.7;-webkit-font-smoothing:antialiased}
    a{color:inherit}

    /* NAV */
    nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(250,248,245,.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);box-shadow:var(--shadow-sm)}
    .nav-inner{max-width:1120px;margin:0 auto;padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:68px}
    .nav-logo{font-family:var(--serif);font-size:1.3rem;font-weight:600;color:var(--ink);text-decoration:none;letter-spacing:-.01em}
    .nav-logo span{color:var(--accent)}
    .nav-back{display:flex;align-items:center;gap:.4rem;text-decoration:none;color:var(--muted);font-size:.9rem;font-weight:500;transition:color .2s}
    .nav-back:hover{color:var(--accent)}

    /* ARTICLE */
    .article-wrapper{max-width:var(--max-w);margin:0 auto;padding:7rem 2rem 4rem}
    .article-meta{margin-bottom:2rem}
    .article-date{font-size:.85rem;color:var(--light-muted);font-weight:500;margin-bottom:.75rem}
    .article-title{font-family:var(--serif);font-size:clamp(1.8rem,4vw,2.8rem);font-weight:700;line-height:1.2;color:var(--ink);margin-bottom:1rem}
    .article-excerpt{font-size:1.1rem;color:var(--muted);line-height:1.7;border-left:3px solid var(--accent);padding-left:1.25rem;margin-bottom:2rem}

    /* ARTICLE BODY */
    .article-body{font-size:1.05rem;line-height:1.85;color:var(--ink)}
    .article-body h2{font-family:var(--serif);font-size:1.5rem;font-weight:600;margin:2.5rem 0 1rem;color:var(--ink)}
    .article-body h3{font-family:var(--serif);font-size:1.25rem;font-weight:600;margin:2rem 0 .75rem;color:var(--ink)}
    .article-body p{margin-bottom:1.25rem}
    .article-body ul,.article-body ol{margin:1rem 0 1.25rem 1.5rem}
    .article-body li{margin-bottom:.5rem}
    .article-body blockquote{border-left:3px solid var(--accent);padding:1rem 1.25rem;margin:1.5rem 0;background:var(--warm-bg);border-radius:0 8px 8px 0;font-style:italic;color:var(--muted)}
    .article-body a{color:var(--accent);text-decoration:underline;text-underline-offset:2px}
    .article-body a:hover{color:var(--accent-hover)}
    .article-body strong{font-weight:600}
    .article-body figure{margin:2rem 0;text-align:center}
    .article-body figure img{max-width:100%;height:auto;border-radius:8px;box-shadow:var(--shadow-md)}
    .article-body figure figcaption{font-size:.85rem;color:var(--muted);margin-top:.6rem;font-style:italic}
    .article-body code{background:var(--warm-bg);padding:.15rem .4rem;border-radius:4px;font-size:.9em}
    .article-body hr{border:none;border-top:1px solid var(--border);margin:2rem 0}

    /* LOADING / ERROR */
    .loading{text-align:center;padding:4rem 0;color:var(--muted);font-size:1rem}
    .error{text-align:center;padding:4rem 0;color:var(--accent)}
    .error h2{font-family:var(--serif);margin-bottom:1rem}
    .error a{color:var(--accent)}

    /* BACK LINK */
    .article-footer{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border)}
    .article-footer a{display:inline-flex;align-items:center;gap:.4rem;color:var(--accent);text-decoration:none;font-weight:500;font-size:.95rem;transition:gap .2s}
    .article-footer a:hover{gap:.6rem}

    /* PROMO BANNER */
    .promo-banner{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.5rem 1.75rem;display:flex;align-items:center;gap:1.25rem;transition:all .2s;text-decoration:none;color:var(--ink)}
    .promo-banner:hover{box-shadow:var(--shadow-md);border-color:var(--accent)}
    .promo-banner::before{content:'';flex-shrink:0;width:4px;height:48px;background:var(--accent);border-radius:2px}
    .promo-content{flex:1;min-width:0}
    .promo-label{font-size:.7rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--accent);margin-bottom:.25rem}
    .promo-title{font-family:var(--serif);font-size:1rem;font-weight:600;line-height:1.35;margin-bottom:.2rem}
    .promo-desc{font-size:.82rem;color:var(--muted);line-height:1.5}
    .promo-cta{flex-shrink:0;background:var(--accent);color:#fff;padding:.5rem 1.1rem;border-radius:6px;font-size:.85rem;font-weight:500;text-decoration:none;transition:background .2s}
    .promo-banner:hover .promo-cta{background:var(--accent-hover)}
    .promo-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:2rem}
    @media(max-width:640px){
      .promo-banner{flex-direction:column;align-items:stretch;text-align:center;gap:.75rem}
      .promo-banner::before{width:100%;height:3px}
      .promo-cta{align-self:center}
      .promo-grid{grid-template-columns:1fr}
    }

    /* FOOTER */
    footer{background:var(--ink);color:rgba(255,255,255,.7);padding:2.5rem 0 1.5rem;margin-top:4rem}
    .footer-inner{max-width:1120px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
    .footer-brand{font-family:var(--serif);font-size:1.1rem;font-weight:600;color:#fff}
    footer p{font-size:.85rem}
    footer a{color:rgba(255,255,255,.85);text-decoration:none}
    footer a:hover{color:#fff}

    @media(max-width:640px){
      .article-wrapper{padding-top:5.5rem}
      .article-title{font-size:1.6rem}
    }
  </style>
</head>
<body>

  <nav>
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">Robert <span>Myhre</span></a>
      <a href="nyheter.html" class="nav-back">&larr; Alle artikler</a>
    </div>
  </nav>

  <article class="article-wrapper" id="article">
    <div class="loading" id="loading">Laster artikkel...</div>
  </article>

  <footer>
    <div class="footer-inner">
      <div>
        <div class="footer-brand">Robert Myhre</div>
        <p>Rådgivning, kurs og innsikt innen offentlige anskaffelser</p>
      </div>
      <p><a href="mailto:robert@robertmyhre.no">robert@robertmyhre.no</a> &middot; <a href="tel:92054415">920 54 415</a></p>
    </div>
  </footer>

  <script src="promo.js"></script>
  <script>
    // Konfigurasjon - same som index.html
    var GITHUB_OWNER = 'sundaypepper';
    var GITHUB_REPO = 'robertmyhre-nyheter';
    var GITHUB_BRANCH = 'main';
    var NYHETER_PATH = 'nyheter';
    var months = ['januar','februar','mars','april','mai','juni','juli','august','september','oktober','november','desember'];

    function parseFrontmatter(text) {
      var fm = {};
      var match = text.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)/);
      if (!match) return { meta: fm, body: text };
      match[1].split('\n').forEach(function(line) {
        var idx = line.indexOf(':');
        if (idx > 0) {
          var key = line.substring(0, idx).trim();
          var val = line.substring(idx + 1).trim().replace(/^["']|["']$/g, '');
          fm[key] = val;
        }
      });
      return { meta: fm, body: match[2] };
    }

    // Bygg bilde-URL fra relativ sti i repo
    function resolveImageUrl(src) {
      if (src.startsWith('http://') || src.startsWith('https://')) return src;
      // Relativ sti i repoet - bygg raw GitHub URL
      return 'https://raw.githubusercontent.com/' + GITHUB_OWNER + '/' + GITHUB_REPO + '/' + GITHUB_BRANCH + '/' + NYHETER_PATH + '/' + src;
    }

    // Enkel markdown til HTML-konvertering
    function markdownToHtml(md) {
      var html = md
        // Overskrifter
        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
        .replace(/^# (.+)$/gm, '<h2>$1</h2>')
        // Horisontal linje
        .replace(/^---$/gm, '<hr>')
        .replace(/^\*\*\*$/gm, '<hr>')
        // Bilder (må komme FØR lenker)
        .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, function(match, alt, src) {
          return '<figure><img src="' + resolveImageUrl(src) + '" alt="' + alt + '" loading="lazy"><figcaption>' + alt + '</figcaption></figure>';
        })
        // Fet og kursiv
        .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        // Lenker
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>')
        // Inline kode
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        // Sitater
        .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')
        // Uordnet liste
        .replace(/^[\-\*] (.+)$/gm, '<li>$1</li>');

      // Wrap consecutive <li> in <ul>
      html = html.replace(/(<li>[\s\S]*?<\/li>)(\s*<li>)/g, '$1$2');
      html = html.replace(/(<li>[\s\S]*?<\/li>)/g, function(match) {
        if (match.indexOf('<ul>') === -1) return '<ul>' + match + '</ul>';
        return match;
      });
      // Merge adjacent </ul><ul>
      html = html.replace(/<\/ul>\s*<ul>/g, '');

      // Avsnitt: wrap linjer som ikke er HTML-tagger
      var lines = html.split('\n');
      var result = [];
      var inBlock = false;
      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();
        if (!line) { result.push(''); continue; }
        if (line.match(/^<(h[23]|ul|ol|li|blockquote|hr|div|pre|table|figure)/)) {
          result.push(line);
          continue;
        }
        if (line.match(/^<\//)) {
          result.push(line);
          continue;
        }
        if (!line.match(/^</)) {
          result.push('<p>' + line + '</p>');
        } else {
          result.push(line);
        }
      }
      return result.join('\n');
    }

    function formatDate(dateStr) {
      try {
        var d = new Date(dateStr);
        if (!isNaN(d)) {
          return d.getDate() + '. ' + months[d.getMonth()] + ' ' + d.getFullYear();
        }
      } catch(e) {}
      return dateStr;
    }

    (async function() {
      var container = document.getElementById('article');
      var loading = document.getElementById('loading');

      // Hent filnavn fra URL-parameter
      var params = new URLSearchParams(window.location.search);
      var fil = params.get('fil');

      if (!fil) {
        container.innerHTML = '<div class="error"><h2>Ingen artikkel valgt</h2><p><a href="nyheter.html">Se alle artikler &rarr;</a></p></div>';
        return;
      }

      try {
        var url = 'https://raw.githubusercontent.com/' + GITHUB_OWNER + '/' + GITHUB_REPO + '/' + GITHUB_BRANCH + '/' + NYHETER_PATH + '/' + fil;
        var r = await fetch(url);
        if (!r.ok) throw new Error('Fant ikke artikkelen');
        var text = await r.text();
        var parsed = parseFrontmatter(text);
        var meta = parsed.meta;
        var body = parsed.body;

        var title = meta.title || fil.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.md$/, '').replace(/-/g, ' ');
        var dateStr = meta.date || fil.substring(0, 10);
        var excerpt = meta.excerpt || meta.description || '';

        document.title = title + ' | Robert Myhre';
        // Oppdater meta-tagger dynamisk for deling
        var metaUpdates = {
          'meta[property="og:title"]': title + ' | Robert Myhre',
          'meta[property="og:description"]': excerpt || title,
          'meta[name="twitter:title"]': title + ' | Robert Myhre',
          'meta[name="twitter:description"]': excerpt || title,
          'meta[name="description"]': excerpt || 'Innsikt og analyser innen offentlige anskaffelser av Robert Myhre.'
        };
        for (var sel in metaUpdates) {
          var el = document.querySelector(sel);
          if (el) el.setAttribute(el.hasAttribute('content') ? 'content' : 'content', metaUpdates[sel]);
        }

        var html = '<div class="article-meta">';
        html += '<p class="article-date">' + formatDate(dateStr) + '</p>';
        html += '<h1 class="article-title">' + title + '</h1>';
        if (excerpt) html += '<p class="article-excerpt">' + excerpt + '</p>';
        html += '</div>';
        var bodyHtml = markdownToHtml(body);
        // Løs relative bilde-URLer i rå <img>-tagger
        bodyHtml = bodyHtml.replace(/<img\s+([^>]*?)src=["']([^"']+)["']/g, function(match, before, src) {
          return '<img ' + before + 'src="' + resolveImageUrl(src) + '"';
        });
        html += '<div class="article-body">' + bodyHtml + '</div>';
        // Promo-bannere (kurs + rådgivning)
        html += PROMO.byggPromoGrid();
        html += '<div class="article-footer"><a href="nyheter.html">&larr; Alle artikler</a></div>';

        container.innerHTML = html;
      } catch(e) {
        container.innerHTML = '<div class="error"><h2>Kunne ikke laste artikkelen</h2><p>' + e.message + '</p><p style="margin-top:1rem"><a href="nyheter.html">Se alle artikler &rarr;</a></p></div>';
      }
    })();
  </script>

</body>
</html>