<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nyhetsarkiv – Robert Myhre</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Georgia', serif;
      background: #fafaf8;
      color: #1a1a1a;
      line-height: 1.6;
    }
    header {
      background: #1a2a3a;
      color: #fff;
      padding: 2rem 1rem;
      text-align: center;
    }
    header h1 {
      font-size: 1.8rem;
      font-weight: 400;
      letter-spacing: 0.02em;
    }
    header p {
      color: #a0b4c8;
      margin-top: 0.4rem;
      font-size: 0.95rem;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1.5rem 1rem;
    }
    .search-box {
      position: sticky;
      top: 0;
      background: #fafaf8;
      padding: 1rem 0;
      z-index: 10;
      border-bottom: 1px solid #e0ddd8;
    }
    .search-box input {
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 2px solid #d0cdc6;
      border-radius: 8px;
      background: #fff;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    .search-box input:focus {
      outline: none;
      border-color: #1a2a3a;
    }
    .search-box input::placeholder {
      color: #999;
    }
    .result-count {
      font-size: 0.85rem;
      color: #777;
      margin-top: 0.5rem;
    }
    .article-list {
      list-style: none;
    }
    .article-item {
      border-bottom: 1px solid #e8e6e1;
      padding: 1.25rem 0;
    }
    .article-item:last-child {
      border-bottom: none;
    }
    .article-item a {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .article-item a:hover h2 {
      color: #2a5a8a;
    }
    .article-date {
      font-size: 0.8rem;
      color: #888;
      font-family: system-ui, sans-serif;
    }
    .article-item h2 {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0.2rem 0 0.4rem;
      line-height: 1.35;
      transition: color 0.15s;
    }
    .article-excerpt {
      font-size: 0.9rem;
      color: #555;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .year-divider {
      font-size: 0.8rem;
      font-family: system-ui, sans-serif;
      font-weight: 700;
      color: #1a2a3a;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-top: 1.5rem;
      padding-bottom: 0.3rem;
      border-bottom: 2px solid #1a2a3a;
    }

    /* Article view */
    #article-view {
      display: none;
    }
    #article-view.active {
      display: block;
    }
    #list-view.hidden {
      display: none;
    }
    .back-link {
      display: inline-block;
      font-family: system-ui, sans-serif;
      font-size: 0.85rem;
      color: #2a5a8a;
      text-decoration: none;
      margin-bottom: 1rem;
      cursor: pointer;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    #article-view h1 {
      font-size: 1.6rem;
      line-height: 1.3;
      margin-bottom: 0.3rem;
    }
    #article-view .article-date {
      margin-bottom: 1.5rem;
      display: block;
    }
    #article-body {
      font-size: 1rem;
      line-height: 1.75;
    }
    #article-body h2, #article-body h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }
    #article-body h2 { font-size: 1.3rem; }
    #article-body h3 { font-size: 1.1rem; }
    #article-body p {
      margin-bottom: 1rem;
    }
    #article-body ul, #article-body ol {
      margin: 0.5rem 0 1rem 1.5rem;
    }
    #article-body li {
      margin-bottom: 0.3rem;
    }
    #article-body strong {
      font-weight: 700;
    }
    #article-body em {
      font-style: italic;
    }
    #article-body img {
      max-width: 100%;
      border-radius: 4px;
      margin: 1rem 0;
    }
    footer {
      text-align: center;
      padding: 2rem 1rem;
      font-size: 0.8rem;
      color: #999;
      font-family: system-ui, sans-serif;
    }
    @media (max-width: 600px) {
      header h1 { font-size: 1.4rem; }
      .article-item h2 { font-size: 1.05rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Nyhetsarkiv</h1>
    <p>Robert Myhre &middot; Offentlige anskaffelser</p>
  </header>

  <div class="container">
    <div id="list-view">
      <div class="search-box">
        <input type="text" id="search" placeholder="Søk i artikler..." autocomplete="off">
        <div class="result-count" id="result-count"></div>
      </div>
      <ul class="article-list" id="article-list"></ul>
    </div>

    <div id="article-view">
      <a class="back-link" id="back-btn">&larr; Tilbake til oversikten</a>
      <h1 id="article-title"></h1>
      <span class="article-date" id="article-date-view"></span>
      <div id="article-body"></div>
    </div>
  </div>

  <footer>
    &copy; Robert Myhre
  </footer>

  <!-- Simple Markdown parser -->
  <script>
    function parseMd(md) {
      let html = md
        // Headers
        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
        // Bold + Italic
        .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
        // Bold
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        // Italic
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        // Images
        .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">')
        // Links
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
        // Unordered lists
        .replace(/^- (.+)$/gm, '<li>$1</li>')
        // Paragraphs
        .split('\n\n')
        .map(block => {
          block = block.trim();
          if (!block) return '';
          if (block.startsWith('<h') || block.startsWith('<img') || block.startsWith('<li>')) {
            if (block.startsWith('<li>')) return '<ul>' + block + '</ul>';
            return block;
          }
          return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
        })
        .join('\n');
      return html;
    }

    let articles = [];
    const REPO_BASE = 'https://raw.githubusercontent.com/sundaypepper/robertmyhre-nyheter/main/nyheter/';

    async function init() {
      const res = await fetch('articles.json');
      articles = await res.json();
      renderList(articles);
      document.getElementById('result-count').textContent = articles.length + ' artikler';

      // Handle URL hash for direct links
      if (window.location.hash) {
        const slug = window.location.hash.slice(1);
        showArticle(slug);
      }
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const months = ['januar','februar','mars','april','mai','juni','juli','august','september','oktober','november','desember'];
      const [y, m, d] = dateStr.split('-');
      return parseInt(d) + '. ' + months[parseInt(m)-1] + ' ' + y;
    }

    function renderList(items) {
      const list = document.getElementById('article-list');
      let html = '';
      let currentYear = '';

      items.forEach(a => {
        const year = a.d ? a.d.slice(0, 4) : '';
        if (year !== currentYear) {
          currentYear = year;
          html += `<div class="year-divider">${year}</div>`;
        }
        html += `
          <li class="article-item">
            <a href="#${a.s}" onclick="showArticle('${a.s}'); return false;">
              <span class="article-date">${formatDate(a.d)}</span>
              <h2>${a.t}</h2>
              <p class="article-excerpt">${a.e}</p>
            </a>
          </li>`;
      });
      list.innerHTML = html;
    }

    // Search
    document.getElementById('search').addEventListener('input', function() {
      const q = this.value.toLowerCase().trim();
      if (!q) {
        renderList(articles);
        document.getElementById('result-count').textContent = articles.length + ' artikler';
        return;
      }
      const filtered = articles.filter(a =>
        a.t.toLowerCase().includes(q) || a.e.toLowerCase().includes(q)
      );
      renderList(filtered);
      document.getElementById('result-count').textContent =
        filtered.length + ' av ' + articles.length + ' artikler';
    });

    // Show single article
    async function showArticle(slug) {
      window.location.hash = slug;
      document.getElementById('list-view').classList.add('hidden');
      const view = document.getElementById('article-view');
      view.classList.add('active');

      const article = articles.find(a => a.s === slug);
      document.getElementById('article-title').textContent = article ? article.t : '';
      document.getElementById('article-date-view').textContent = article ? formatDate(article.d) : '';
      document.getElementById('article-body').innerHTML = '<p style="color:#999">Laster artikkel...</p>';

      try {
        const res = await fetch(REPO_BASE + slug + '.md');
        let md = await res.text();
        // Strip frontmatter
        if (md.startsWith('---')) {
          const end = md.indexOf('---', 3);
          if (end > 0) md = md.slice(end + 3).trim();
        }
        document.getElementById('article-body').innerHTML = parseMd(md);
      } catch (e) {
        document.getElementById('article-body').innerHTML = '<p>Kunne ikke laste artikkelen.</p>';
      }

      window.scrollTo(0, 0);
    }

    // Back button
    document.getElementById('back-btn').addEventListener('click', function() {
      window.location.hash = '';
      document.getElementById('article-view').classList.remove('active');
      document.getElementById('list-view').classList.remove('hidden');
    });

    // Handle browser back/forward
    window.addEventListener('hashchange', function() {
      if (!window.location.hash) {
        document.getElementById('article-view').classList.remove('active');
        document.getElementById('list-view').classList.remove('hidden');
      } else {
        showArticle(window.location.hash.slice(1));
      }
    });

    init();
  </script>
</body>
</html>
