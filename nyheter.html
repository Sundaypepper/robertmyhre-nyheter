<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Innsikt | Robert Myhre</title>
  <meta name="description" content="Analyser og kommentarer om offentlige anskaffelser av Robert Myhre. KOFA-praksis, EU-dommer og regelverksendringer.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;0,8..60,700;1,8..60,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#2c2825;--paper:#faf8f5;--warm-bg:#f0ece5;--accent:#9e4a32;--accent-hover:#b85a3f;--muted:#7a7269;--light-muted:#a39e96;--card:#fff;--border:#e2ddd5;--shadow-sm:0 1px 3px rgba(44,40,37,.06);--shadow-md:0 4px 16px rgba(44,40,37,.08);--shadow-lg:0 8px 32px rgba(44,40,37,.1);--serif:'Source Serif 4',Georgia,serif;--sans:'Outfit',system-ui,sans-serif;--max-w:1120px}
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:var(--sans);color:var(--ink);background:var(--paper);font-size:16px;line-height:1.7;-webkit-font-smoothing:antialiased}
    a{color:inherit}

    /* NAV */
    nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(250,248,245,.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);box-shadow:var(--shadow-sm)}
    .nav-inner{max-width:var(--max-w);margin:0 auto;padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:68px}
    .nav-logo{font-family:var(--serif);font-size:1.3rem;font-weight:600;color:var(--ink);text-decoration:none;letter-spacing:-.01em}
    .nav-logo span{color:var(--accent)}
    .nav-back{display:flex;align-items:center;gap:.4rem;text-decoration:none;color:var(--muted);font-size:.9rem;font-weight:500;transition:color .2s}
    .nav-back:hover{color:var(--accent)}

    /* PAGE HEADER */
    .page-header{padding:7rem 0 3rem;text-align:center}
    .page-header .container{max-width:var(--max-w);margin:0 auto;padding:0 2rem}
    .page-label{font-size:.75rem;font-weight:600;letter-spacing:.14em;text-transform:uppercase;color:var(--accent);margin-bottom:.75rem}
    .page-title{font-family:var(--serif);font-size:clamp(1.8rem,4vw,2.6rem);font-weight:600;line-height:1.25;color:var(--ink);margin-bottom:1rem}
    .page-subtitle{font-size:1.05rem;color:var(--muted);max-width:600px;margin:0 auto;line-height:1.7}

    /* ARTICLE LIST */
    .articles-container{max-width:var(--max-w);margin:0 auto;padding:0 2rem 4rem}
    .articles-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.5rem}
    .article-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.75rem;text-decoration:none;transition:all .2s;display:flex;flex-direction:column}
    .article-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px);border-color:var(--accent)}
    .article-card .card-date{font-size:.78rem;color:var(--light-muted);font-weight:500;margin-bottom:.6rem}
    .article-card h3{font-family:var(--serif);font-size:1.1rem;font-weight:600;line-height:1.35;margin-bottom:.6rem;color:var(--ink)}
    .article-card p{font-size:.88rem;color:var(--muted);line-height:1.6;flex:1}
    .article-card .les-mer{margin-top:1rem;font-size:.85rem;font-weight:500;color:var(--accent)}
    .article-card:hover .les-mer{text-decoration:underline}

    /* SEARCH */
    .search-section{max-width:var(--max-w);margin:0 auto;padding:0 2rem 1rem}
    .search-wrap{position:sticky;top:68px;z-index:10;background:var(--paper);padding:1rem 0}
    .search-input{width:100%;padding:.75rem 1rem .75rem 2.8rem;font-size:1rem;font-family:var(--sans);border:2px solid var(--border);border-radius:10px;background:var(--card);color:var(--ink);transition:border-color .2s}
    .search-input:focus{outline:none;border-color:var(--accent)}
    .search-input::placeholder{color:var(--light-muted)}
    .search-wrap svg{position:absolute;left:.85rem;top:50%;transform:translateY(-50%);color:var(--light-muted);pointer-events:none}
    .search-wrap{position:sticky;top:68px;z-index:10;background:var(--paper);padding:1rem 0}
    .search-inner{position:relative}
    .result-count{font-size:.82rem;color:var(--light-muted);margin-top:.5rem}

    /* LOADING */
    .loading{text-align:center;padding:4rem 0;color:var(--muted)}

    /* FOOTER */
    footer{background:var(--ink);color:rgba(255,255,255,.7);padding:2.5rem 0 1.5rem;margin-top:2rem}
    .footer-inner{max-width:var(--max-w);margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
    .footer-brand{font-family:var(--serif);font-size:1.1rem;font-weight:600;color:#fff}
    footer p{font-size:.85rem}
    footer a{color:rgba(255,255,255,.85);text-decoration:none}
    footer a:hover{color:#fff}

    @media(max-width:640px){
      .page-header{padding-top:5.5rem}
      .articles-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

  <nav>
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">Robert <span>Myhre</span></a>
      <a href="index.html" class="nav-back">&larr; Tilbake til forsiden</a>
    </div>
  </nav>

  <header class="page-header">
    <div class="container">
      <p class="page-label">Innsikt</p>
      <h1 class="page-title">Analyser og kommentarer</h1>
      <p class="page-subtitle">Praktiske analyser av KOFA-praksis, EU-dommer og regelverksendringer.</p>
    </div>
  </header>

  <div class="search-section">
    <div class="search-wrap">
      <div class="search-inner">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" class="search-input" id="searchInput" placeholder="Søk i artikler..." autocomplete="off">
      </div>
      <div class="result-count" id="resultCount"></div>
    </div>
  </div>

  <div class="articles-container">
    <div class="articles-grid" id="articlesGrid">
      <div class="loading">Laster artikler...</div>
    </div>
  </div>

  <footer>
    <div class="footer-inner">
      <div>
        <div class="footer-brand">Robert Myhre</div>
        <p>Rådgivning, kurs og innsikt innen offentlige anskaffelser</p>
      </div>
      <p><a href="mailto:robert@robertmyhre.no">robert@robertmyhre.no</a> &middot; <a href="tel:92054415">920 54 415</a></p>
    </div>
  </footer>

  <script>
    var GITHUB_OWNER = 'sundaypepper';
    var GITHUB_REPO = 'robertmyhre-nyheter';
    var GITHUB_BRANCH = 'main';
    var NYHETER_PATH = 'nyheter';
    var months = ['januar','februar','mars','april','mai','juni','juli','august','september','oktober','november','desember'];

    var FALLBACK = [
      {title:'Innovasjonspartnerskap: En risikabel vei til kjent teknologi?',date:'Februar 2025',excerpt:'Er innovasjon best drevet gjennom komplekse partnerskap, eller oppnår man mer ved å stille åpne funksjonskrav?',fil:''},
      {title:'Prisene skal gjenspeile de faktiske kostnadene',date:'Februar 2025',excerpt:'Et krav basert på en grunnleggende misforståelse av hvordan leverandører priser anbud.',fil:''},
      {title:'Når pris og kvalitet blandes i samme evalueringskriterium',date:'Januar 2025',excerpt:'KOFA-sak 2025/1673 reiser spørsmål om evalueringskriterier der kvalitet og pris vurderes samlet.',fil:''}
    ];

    function parseFrontmatter(text) {
      var fm = {};
      var match = text.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)/);
      if (!match) return { meta: fm, body: text };
      match[1].split('\n').forEach(function(line) {
        var idx = line.indexOf(':');
        if (idx > 0) {
          var key = line.substring(0, idx).trim();
          var val = line.substring(idx + 1).trim().replace(/^["']|["']$/g, '');
          fm[key] = val;
        }
      });
      return { meta: fm, body: match[2] };
    }

    function formatDate(dateStr) {
      try {
        var d = new Date(dateStr);
        if (!isNaN(d)) {
          return months[d.getMonth()].charAt(0).toUpperCase() + months[d.getMonth()].slice(1) + ' ' + d.getFullYear();
        }
      } catch(e) {}
      return dateStr;
    }

    function renderArticles(articles) {
      var g = document.getElementById('articlesGrid');
      if (!articles.length) {
        g.innerHTML = '<p style="text-align:center;color:var(--muted);grid-column:1/-1">Ingen artikler publisert ennå.</p>';
        return;
      }
      g.innerHTML = articles.map(function(a) {
        var href = a.fil ? 'artikkel.html?fil=' + encodeURIComponent(a.fil) : '#';
        return '<a href="' + href + '" class="article-card">'
          + '<span class="card-date">' + a.date + '</span>'
          + '<h3>' + a.title + '</h3>'
          + '<p>' + a.excerpt + '</p>'
          + '<span class="les-mer">Les mer &rarr;</span></a>';
      }).join('');
    }

    var allArticles = [];

    function setupSearch() {
      var input = document.getElementById('searchInput');
      var countEl = document.getElementById('resultCount');
      countEl.textContent = allArticles.length + ' artikler';

      input.addEventListener('input', function() {
        var q = this.value.toLowerCase().trim();
        if (!q) {
          renderArticles(allArticles);
          countEl.textContent = allArticles.length + ' artikler';
          return;
        }
        var filtered = allArticles.filter(function(a) {
          return a.title.toLowerCase().indexOf(q) !== -1 || a.excerpt.toLowerCase().indexOf(q) !== -1;
        });
        renderArticles(filtered);
        countEl.textContent = filtered.length + ' av ' + allArticles.length + ' artikler';
      });
    }

    (async function() {
      try {
        var apiUrl = 'https://api.github.com/repos/' + GITHUB_OWNER + '/' + GITHUB_REPO + '/contents/' + NYHETER_PATH + '?ref=' + GITHUB_BRANCH;
        var r = await fetch(apiUrl);
        if (!r.ok) throw new Error('Kunne ikke hente fra GitHub');
        var files = await r.json();
        var mdFiles = files.filter(function(f) { return f.name.endsWith('.md'); })
          .sort(function(a, b) { return b.name.localeCompare(a.name); });

        if (!mdFiles.length) throw new Error('Ingen artikler');

        allArticles = await Promise.all(mdFiles.map(async function(f) {
          var raw = await fetch(f.download_url);
          var text = await raw.text();
          var parsed = parseFrontmatter(text);
          var meta = parsed.meta;
          var body = parsed.body;

          var title = meta.title || f.name.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.md$/, '').replace(/-/g, ' ');
          var dateStr = meta.date || f.name.substring(0, 10);
          var excerpt = meta.excerpt || meta.description || body.substring(0, 200).replace(/[#*_\[\]]/g, '').trim() + '...';

          return { title: title, date: formatDate(dateStr), excerpt: excerpt, fil: f.name };
        }));
        renderArticles(allArticles);
        setupSearch();
      } catch(e) {
        console.log('GitHub-henting feilet:', e.message);
        allArticles = FALLBACK;
        renderArticles(FALLBACK);
        setupSearch();
      }
    })();
  </script>

</body>
</html>